<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="900px" preserveAspectRatio="none" style="width:1110px;height:900px;background:#FFFFFF;" version="1.1" viewBox="0 0 1110 900" width="1110px" zoomAndPan="magnify"><title>Current System (As-Is) - LLM Load Balancer</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="343.7041" x="379.5144" y="27.9951">Current System (As-Is) - LLM Load Balancer</text><rect fill="none" height="314.5938" style="stroke:#000000;stroke-width:1.5;" width="1083.7329" x="10" y="293.125"/><rect fill="none" height="96.2031" style="stroke:#000000;stroke-width:1.5;" width="670.2764" x="10" y="664.8516"/><g><title>Airflow DAG</title><rect fill="#000000" fill-opacity="0.00000" height="701.5938" width="8" x="60.8564" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="118.5938" y2="820.1875"/></g><g><title>PostgreSQL</title><rect fill="#000000" fill-opacity="0.00000" height="701.5938" width="8" x="287.4648" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="290.667" x2="290.667" y1="118.5938" y2="820.1875"/></g><g><title>Worker x20</title><rect fill="#000000" fill-opacity="0.00000" height="701.5938" width="8" x="552.5996" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="555.7856" x2="555.7856" y1="118.5938" y2="820.1875"/></g><g><title>Models Backend</title><rect fill="#000000" fill-opacity="0.00000" height="701.5938" width="8" x="777.126" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="780.4766" x2="780.4766" y1="118.5938" y2="820.1875"/></g><g><title>LLM Models (10)</title><rect fill="#000000" fill-opacity="0.00000" height="701.5938" width="8" x="1015.4102" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1019.0874" x2="1019.0874" y1="118.5938" y2="820.1875"/></g><g class="participant participant-head" data-participant="DAG"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.7129" x="20" y="115.292">Airflow DAG</text><ellipse cx="64.8564" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M64.8564,58.7969 L64.8564,85.7969 M51.8564,66.7969 L77.8564,66.7969 M64.8564,85.7969 L51.8564,100.7969 M64.8564,85.7969 L77.8564,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="DAG"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.7129" x="20" y="832.1826">Airflow DAG</text><ellipse cx="64.8564" cy="843.9844" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M64.8564,851.9844 L64.8564,878.9844 M51.8564,859.9844 L77.8564,859.9844 M64.8564,878.9844 L51.8564,893.9844 M64.8564,878.9844 L77.8564,893.9844" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="PG"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.5957" x="240.667" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="251.0884" y="90.9951">PostgreSQL</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.5957" x="247.667" y="107.292">(tasks table)</text></g><g class="participant participant-tail" data-participant="PG"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.5957" x="240.667" y="819.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7529" x="251.0884" y="839.1826">PostgreSQL</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.5957" x="247.667" y="855.4795">(tasks table)</text></g><g class="participant participant-head" data-participant="W"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.6279" x="494.7856" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1904" x="516.0044" y="90.9951">Worker x20</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.6279" x="501.7856" y="107.292">(mapped tasks)</text></g><g class="participant participant-tail" data-participant="W"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.6279" x="494.7856" y="819.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1904" x="516.0044" y="839.1826">Worker x20</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.6279" x="501.7856" y="855.4795">(mapped tasks)</text></g><g class="participant participant-head" data-participant="MB"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.2988" x="675.4766" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.1396" x="724.0562" y="90.9951">Models Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197.2988" x="682.4766" y="107.292">(FastAPI: /single and /batch)</text></g><g class="participant participant-tail" data-participant="MB"><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="211.2988" x="675.4766" y="819.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.1396" x="724.0562" y="839.1826">Models Backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="197.2988" x="682.4766" y="855.4795">(FastAPI: /single and /batch)</text></g><g class="participant participant-head" data-participant="MODELS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128.6455" x="955.0874" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.6455" x="962.0874" y="107.292">LLM Models (10)</text></g><g class="participant participant-tail" data-participant="MODELS"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128.6455" x="955.0874" y="819.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.6455" x="962.0874" y="839.1826">LLM Models (10)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1103.7329" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1103.7329" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1103.7329" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="87.3345" x="508.1992" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="68.8086" x="514.1992" y="154.6606">Ingestion</text><g class="message" data-participant-1="DAG" data-participant-2="PG"><polygon fill="#181818" points="279.4648,188.8594,289.4648,192.8594,279.4648,196.8594,283.4648,192.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="64.8564" x2="285.4648" y1="192.8594" y2="192.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.77" x="71.8564" y="187.7935">Fetch all new UNSOLVED tasks</text></g><g class="message" data-participant-1="DAG" data-participant-2="DAG"><line style="stroke:#181818;stroke-width:1;" x1="64.8564" x2="106.8564" y1="221.9922" y2="221.9922"/><line style="stroke:#181818;stroke-width:1;" x1="106.8564" x2="106.8564" y1="221.9922" y2="234.9922"/><line style="stroke:#181818;stroke-width:1;" x1="65.8564" x2="106.8564" y1="234.9922" y2="234.9922"/><polygon fill="#181818" points="75.8564,230.9922,65.8564,234.9922,75.8564,238.9922,71.8564,234.9922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.6084" x="71.8564" y="216.9263">Split tasks into 20 equal batches</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1103.7329" x="0" y="263.5586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1103.7329" y1="263.5586" y2="263.5586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1103.7329" y1="266.5586" y2="266.5586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="119.7583" x="491.9873" y="252.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.2324" x="497.9873" y="269.0591">Orchestration</text><path d="M10,293.125 L86.624,293.125 L86.624,300.2578 L76.624,310.2578 L10,310.2578 L10,293.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="314.5938" style="stroke:#000000;stroke-width:1.5;" width="1083.7329" x="10" y="293.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="25" y="306.1919">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151.6689" x="101.624" y="305.3354">[For each of 20 batches]</text><g class="message" data-participant-1="DAG" data-participant-2="W"><polygon fill="#181818" points="544.5996,327.3906,554.5996,331.3906,544.5996,335.3906,548.5996,331.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="64.8564" x2="550.5996" y1="331.3906" y2="331.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242.3916" x="71.8564" y="326.3247">Spawn mapped worker (for its batch)</text></g><g class="message" data-participant-1="W" data-participant-2="MB"><polygon fill="#181818" points="769.126,356.5234,779.126,360.5234,769.126,364.5234,773.126,360.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="556.5996" x2="775.126" y1="360.5234" y2="360.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.1362" x="563.5996" y="355.4575">POST /batch with 10 tasks</text></g><path d="M639,373.5234 L639,443.5234 L921,443.5234 L921,383.5234 L911,373.5234 L639,373.5234" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M911,373.5234 L911,383.5234 L921,383.5234 L911,373.5234" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.7266" x="645" y="390.5903">Under the hood:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.8042" x="645" y="405.7231">- Splits into parallel model calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.002" x="645" y="420.856">- Single-prompt latency: ~1s-2m</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261.2886" x="645" y="435.9888">- Responds only after all tasks complete</text><g class="message" data-participant-1="MB" data-participant-2="MODELS"><polygon fill="#181818" points="1007.4102,466.1875,1017.4102,470.1875,1007.4102,474.1875,1011.4102,470.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="781.126" x2="1013.4102" y1="470.1875" y2="470.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214.2842" x="788.126" y="465.1216">Fan-out calls to available models</text></g><g class="message" data-participant-1="MODELS" data-participant-2="MB"><polygon fill="#181818" points="792.126,495.3203,782.126,499.3203,792.126,503.3203,788.126,499.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="786.126" x2="1018.4102" y1="499.3203" y2="499.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109.2686" x="798.126" y="494.2544">Model responses</text></g><g class="message" data-participant-1="MB" data-participant-2="W"><polygon fill="#181818" points="567.5996,524.4531,557.5996,528.4531,567.5996,532.4531,563.5996,528.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="561.5996" x2="780.126" y1="528.4531" y2="528.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.3359" x="573.5996" y="523.3872">Aggregated batch result</text></g><g class="message" data-participant-1="W" data-participant-2="PG"><polygon fill="#181818" points="302.4648,553.5859,292.4648,557.5859,302.4648,561.5859,298.4648,557.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="296.4648" x2="555.5996" y1="557.5859" y2="557.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.1348" x="308.4648" y="552.52">Update answers; set status=SOLVED</text></g><g class="message" data-participant-1="W" data-participant-2="W"><line style="stroke:#181818;stroke-width:1;" x1="556.5996" x2="598.5996" y1="586.7188" y2="586.7188"/><line style="stroke:#181818;stroke-width:1;" x1="598.5996" x2="598.5996" y1="586.7188" y2="599.7188"/><line style="stroke:#181818;stroke-width:1;" x1="557.5996" x2="598.5996" y1="599.7188" y2="599.7188"/><polygon fill="#181818" points="567.5996,595.7188,557.5996,599.7188,567.5996,603.7188,563.5996,599.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.5264" x="563.5996" y="581.6528">Pull next 10 tasks from its batch</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1103.7329" x="0" y="635.2852"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1103.7329" y1="635.2852" y2="635.2852"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1103.7329" y1="638.2852" y2="638.2852"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="125.9917" x="488.8706" y="624.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107.4658" x="494.8706" y="640.7856">Control / Retry</text><path d="M10,664.8516 L74.4429,664.8516 L74.4429,671.9844 L64.4429,681.9844 L10,681.9844 L10,664.8516" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="96.2031" style="stroke:#000000;stroke-width:1.5;" width="670.2764" x="10" y="664.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="677.9185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="107.7979" x="89.4429" y="677.062">[Worker timeout]</text><path d="M442,686.9844 L442,711.9844 L670,711.9844 L670,696.9844 L660,686.9844 L442,686.9844" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M660,686.9844 L660,696.9844 L670,696.9844 L660,686.9844" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.2764" x="448" y="704.0513">Per-worker timeout: 30 minutes</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="680.2764" y1="718.1172" y2="718.1172"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="133.5308" x="15" y="728.3276">[All workers finished]</text><g class="message" data-participant-1="W" data-participant-2="DAG"><polygon fill="#181818" points="75.8564,749.0547,65.8564,753.0547,75.8564,757.0547,71.8564,753.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="69.8564" x2="555.5996" y1="753.0547" y2="753.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.3389" x="81.8564" y="747.9888">Report completion</text></g><g class="message" data-participant-1="DAG" data-participant-2="DAG"><line style="stroke:#181818;stroke-width:1;" x1="64.8564" x2="106.8564" y1="789.1875" y2="789.1875"/><line style="stroke:#181818;stroke-width:1;" x1="106.8564" x2="106.8564" y1="789.1875" y2="802.1875"/><line style="stroke:#181818;stroke-width:1;" x1="65.8564" x2="106.8564" y1="802.1875" y2="802.1875"/><polygon fill="#181818" points="75.8564,798.1875,65.8564,802.1875,75.8564,806.1875,71.8564,802.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.4185" x="71.8564" y="784.1216">Restart DAG</text></g><!--SRC=[NLFBRjim4BphAmOvEGSXJdfJuG9s7aK0ktRZfhxqmaXhcmX5gkGgYY_zzYv5gQshYqHfTdPcTiMQ3U6szPuiOtiAJ3Kcyv0_XalaM2vNM3fLOQ6CiYNvB5CbEu-BkVPxuphSpJzVG8LupnhbMPUwKK9riN613vwsNvS_x8HLU0rWzMBeieTl_aFld7ybZ_URgQ1hrJHKeIzAyDqvUkKgCa54bQzaAwbuK87dcyS2Lq7RWpXIjiBLY-Boc0XMYtE6Q6nWcLnF1ypwxdwvpRBP38_sG86rivZDCh66_9D8Bl10mWXb32nrUFwoNI-_tzybfIDERWMsZT6StaDRThYPWdwsog0NHQ5li_RnaRqQMndd6Zn8lgIaZzl7ih4061hi8htgB8QSkfJTP2zrcaCgk1JyBg9NYmARzVRR40SwpKTSJmVDW7LCS6z281b1hcTRoO6FXADpLT6_ovEXmOiaAH6GGHqJH2c7CCBw-FF6kxfX6CLaorE1NzSXlwa7p1E5njagm5bpWjgpj8kHfhHAgJJ4962PRIyla-VLeZVJZqZce6pkMawj8PBKcz8chbVI5EKaBF8XWtxQy7tlqCSPALESyuDiwa74LYcy26iDZn76oJytbNoNlGeT-V0HWHY15RTXbfPW10lTfkqNv9t_v8oz1F9tE9auwnVWrbdspk1AGc5_YYkW36Fu6rZN92xFXXJfoUVT6QB0XobgRLiMO-AUC1S52IEzjTNXI5LIE6xe4pNEynYtx5yIzUyIow1OVffu-0q0]--></g></svg>