<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="671px" preserveAspectRatio="none" style="width:714px;height:671px;background:#FFFFFF;" version="1.1" viewBox="0 0 714 671" width="714px" zoomAndPan="magnify"><title>Iteration 1 &#8212; Routing with WDRR</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="261.7959" x="222.5439" y="27.9951">Iteration 1 &#8212; Routing with WDRR</text><rect fill="none" height="307.1328" style="stroke:#000000;stroke-width:1.5;" width="687.8838" x="10" y="266.125"/><g><title>Airflow</title><rect fill="#000000" fill-opacity="0.00000" height="471.6641" width="8" x="43.0283" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="118.5938" y2="590.2578"/></g><g><title>Routing Service</title><rect fill="#000000" fill-opacity="0.00000" height="471.6641" width="8" x="312.5493" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="316.3013" x2="316.3013" y1="118.5938" y2="590.2578"/></g><g><title>Redis</title><rect fill="#000000" fill-opacity="0.00000" height="471.6641" width="8" x="523.5386" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="527.333" x2="527.333" y1="118.5938" y2="590.2578"/></g><g><title>Models Backend</title><rect fill="#000000" fill-opacity="0.00000" height="471.6641" width="8" x="619.814" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="623.7441" x2="623.7441" y1="118.5938" y2="590.2578"/></g><g class="participant participant-head" data-participant="Airflow"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.0566" x="20" y="115.292">Airflow</text><ellipse cx="47.0283" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.0283,58.7969 L47.0283,85.7969 M34.0283,66.7969 L60.0283,66.7969 M47.0283,85.7969 L34.0283,100.7969 M47.0283,85.7969 L60.0283,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Airflow"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48.0566" x="20" y="602.2529">Airflow</text><ellipse cx="47.0283" cy="614.0547" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47.0283,622.0547 L47.0283,649.0547 M34.0283,630.0547 L60.0283,630.0547 M47.0283,649.0547 L34.0283,664.0547 M47.0283,649.0547 L60.0283,664.0547" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Router"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.4961" x="254.3013" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.4961" x="261.3013" y="107.292">Routing Service</text></g><g class="participant participant-tail" data-participant="Router"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.4961" x="254.3013" y="589.2578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.4961" x="261.3013" y="609.2529">Routing Service</text></g><g class="participant participant-head" data-participant="R"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.4111" x="505.333" y="115.292">Redis</text><path d="M509.5386,66.2969 C509.5386,56.2969 527.5386,56.2969 527.5386,56.2969 C527.5386,56.2969 545.5386,56.2969 545.5386,66.2969 L545.5386,92.2969 C545.5386,102.2969 527.5386,102.2969 527.5386,102.2969 C527.5386,102.2969 509.5386,102.2969 509.5386,92.2969 L509.5386,66.2969" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M509.5386,66.2969 C509.5386,76.2969 527.5386,76.2969 527.5386,76.2969 C527.5386,76.2969 545.5386,76.2969 545.5386,66.2969" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-tail" data-participant="R"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.4111" x="505.333" y="602.2529">Redis</text><path d="M509.5386,615.5547 C509.5386,605.5547 527.5386,605.5547 527.5386,605.5547 C527.5386,605.5547 545.5386,605.5547 545.5386,615.5547 L545.5386,641.5547 C545.5386,651.5547 527.5386,651.5547 527.5386,651.5547 C527.5386,651.5547 509.5386,651.5547 509.5386,641.5547 L509.5386,615.5547" fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M509.5386,615.5547 C509.5386,625.5547 527.5386,625.5547 527.5386,625.5547 C527.5386,625.5547 545.5386,625.5547 545.5386,615.5547" fill="none" style="stroke:#181818;stroke-width:1.5;"/></g><g class="participant participant-head" data-participant="MB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128.1396" x="559.7441" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.1396" x="566.7441" y="107.292">Models Backend</text></g><g class="participant participant-tail" data-participant="MB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="128.1396" x="559.7441" y="589.2578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114.1396" x="566.7441" y="609.2529">Models Backend</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="707.8838" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="707.8838" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="707.8838" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="94.0122" x="306.9358" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="75.4863" x="312.9358" y="154.6606">Admission</text><g class="message" data-participant-1="Airflow" data-participant-2="Router"><polygon fill="#181818" points="304.5493,188.8594,314.5493,192.8594,304.5493,196.8594,308.5493,192.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.0283" x2="310.5493" y1="192.8594" y2="192.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245.521" x="54.0283" y="187.7935">POST /schedule { estimated_tokens }</text></g><g class="message" data-participant-1="Router" data-participant-2="R"><polygon fill="#181818" points="515.5386,217.9922,525.5386,221.9922,515.5386,225.9922,519.5386,221.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="316.5493" x2="521.5386" y1="221.9922" y2="221.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186.9893" x="323.5493" y="216.9263">LUA: refill + WDRR + guards</text></g><g class="message" data-participant-1="R" data-participant-2="Router"><polygon fill="#181818" points="327.5493,247.125,317.5493,251.125,327.5493,255.125,323.5493,251.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="321.5493" x2="526.5386" y1="251.125" y2="251.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.085" x="333.5493" y="246.0591">{admit | wait}</text></g><path d="M10,266.125 L74.4429,266.125 L74.4429,273.2578 L64.4429,283.2578 L10,283.2578 L10,266.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="307.1328" style="stroke:#000000;stroke-width:1.5;" width="687.8838" x="10" y="266.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="279.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="45.8423" x="89.4429" y="278.3354">[admit]</text><g class="message" data-participant-1="Router" data-participant-2="Airflow"><polygon fill="#181818" points="58.0283,300.3906,48.0283,304.3906,58.0283,308.3906,54.0283,304.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="52.0283" x2="315.5493" y1="304.3906" y2="304.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.5259" x="64.0283" y="299.3247">{ model_backend_id, task_id }</text></g><g class="message" data-participant-1="Airflow" data-participant-2="MB"><polygon fill="#181818" points="611.814,329.5234,621.814,333.5234,611.814,337.5234,615.814,333.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.0283" x2="617.814" y1="333.5234" y2="333.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.207" x="54.0283" y="328.4575">call(model_backend_id)</text></g><g class="message" data-participant-1="MB" data-participant-2="Airflow"><polygon fill="#181818" points="58.0283,358.6563,48.0283,362.6563,58.0283,366.6563,54.0283,362.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="52.0283" x2="622.814" y1="362.6563" y2="362.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164.9819" x="64.0283" y="357.5903">result (opaque to Router)</text></g><g class="message" data-participant-1="Airflow" data-participant-2="Router"><polygon fill="#181818" points="304.5493,387.7891,314.5493,391.7891,304.5493,395.7891,308.5493,391.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.0283" x2="310.5493" y1="391.7891" y2="391.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.166" x="54.0283" y="386.7231">POST /complete { task_id }</text></g><g class="message" data-participant-1="Router" data-participant-2="R"><polygon fill="#181818" points="515.5386,416.9219,525.5386,420.9219,515.5386,424.9219,519.5386,420.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="316.5493" x2="521.5386" y1="420.9219" y2="420.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.1216" x="323.5493" y="415.856">in_flight--</text></g><g class="message" data-participant-1="Router" data-participant-2="Airflow"><polygon fill="#181818" points="58.0283,446.0547,48.0283,450.0547,58.0283,454.0547,54.0283,450.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="52.0283" x2="315.5493" y1="450.0547" y2="450.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75.48" x="64.0283" y="444.9888">{ ok: true }</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="10" x2="697.8838" y1="459.0547" y2="459.0547"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="36.6685" x="15" y="469.2651">[wait]</text><g class="message" data-participant-1="Router" data-participant-2="Airflow"><polygon fill="#181818" points="58.0283,489.9922,48.0283,493.9922,58.0283,497.9922,54.0283,493.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="52.0283" x2="315.5493" y1="493.9922" y2="493.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102.4258" x="64.0283" y="488.9263">{ wait_for_ms }</text></g><g class="message" data-participant-1="Airflow" data-participant-2="Airflow"><line style="stroke:#181818;stroke-width:1;" x1="47.0283" x2="89.0283" y1="523.125" y2="523.125"/><line style="stroke:#181818;stroke-width:1;" x1="89.0283" x2="89.0283" y1="523.125" y2="536.125"/><line style="stroke:#181818;stroke-width:1;" x1="48.0283" x2="89.0283" y1="536.125" y2="536.125"/><polygon fill="#181818" points="58.0283,532.125,48.0283,536.125,58.0283,540.125,54.0283,536.125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.3955" x="54.0283" y="518.0591">sleep(wait_for_ms)</text></g><g class="message" data-participant-1="Airflow" data-participant-2="Router"><polygon fill="#181818" points="304.5493,561.2578,314.5493,565.2578,304.5493,569.2578,308.5493,565.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="47.0283" x2="310.5493" y1="565.2578" y2="565.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98.249" x="54.0283" y="560.1919">retry /schedule</text></g><!--SRC=[TP71IiD048Rl-nH3JoqQn6iWGeiNmQ2qYiSmpKxQePjit9rOf1Py29_G9t6JHcqAFMN9VlFF__yhB8RWJiYXiAtW6hu_ls1k6-5g1LkMDRpSpkTAOIxMmPHTOUnMrUY4Swwn4XZzqWjoRvpJ2D1t2kIKHi4bUWeGQVQ7g-5qQZKP3pFCDrJfZaXdIYK9J7N9thUkaaJrco6wwRLZU7nOFC6LpzUacn1Y1-I5InJIcTWWvc6l3cmt5SFzypG6HmKR0nTThl1PDUYqLtE8ZgHt67OBVC0MMVOAZK3tHm7yAWQwznHmADiKsV8G8cDz2O9-4mx10y2H-NGMGux6Z4yd9e5BPqDTHxu9gyUsnjU6G6o_VJBK71QIsx8s96qXnnu6JN2L5OPNQucYiv7i9WPnOUrUXGUYhegpS7kP5TPbfJzD_4TvGrIFZyWpCHo9U_z_M1Nw-G40]--></g></svg>